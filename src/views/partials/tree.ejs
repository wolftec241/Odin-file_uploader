<div class="tree-container">
  <ul class="folders">
    <li>
      <a href="/dashboard/<%= rootFolder.id %>" 
         class="<%= rootFolder.id === currentFolderId ? 'active-folder' : '' %>">
        üìÅ <%= rootFolder.name %>
      </a>
      
      <% if (rootFolder.subfolders && rootFolder.subfolders.length > 0) { %>
        <ul>
          <% rootFolder.subfolders.forEach(function(folder) { %>
            <% 
              // Check if this folder is in the current path (with safety check)
              const isInPath = currentPath && currentPath.some(p => p.id === folder.id);
              const isActive = folder.id === currentFolderId;
            %>
            <li>
              <a href="/dashboard/<%= folder.id %>" 
                 class="<%= isActive ? 'active-folder' : '' %>">
                üìÅ <%= folder.name %>
              </a>
              
              <% if (isInPath && folder.subfolders && folder.subfolders.length > 0) { %>
                <ul>
                  <% folder.subfolders.forEach(function(subfolder) { %>
                    <% 
                      const subIsInPath = currentPath && currentPath.some(p => p.id === subfolder.id);
                      const subIsActive = subfolder.id === currentFolderId;
                    %>
                    <li>
                      <a href="/dashboard/<%= subfolder.id %>" 
                         class="<%= subIsActive ? 'active-folder' : '' %>">
                        üìÅ <%= subfolder.name %>
                      </a>
                      
                      <% if (subIsInPath && subfolder.subfolders && subfolder.subfolders.length > 0) { %>
                        <!-- Add more levels here if needed -->
                      <% } %>
                    </li>
                  <% }); %>
                </ul>
              <% } %>
            </li>
          <% }); %>
        </ul>
      <% } %>
    </li>
  </ul>
</div>